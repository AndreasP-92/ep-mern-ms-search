name: Push docker images

on:
  push:

defaults:
  run:
    working-directory: ./search-microservice

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v2

      - name: Login to Docker Repository
        uses: docker/login-action@v1
        with:
          registry: ${{ secrets.ACR_ENDPOINT }}
          username: ${{ secrets.ACR_USERNAME }}
          password: ${{ secrets.ACR_PASSWORD }}

      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v1

      - name: Log into registry
        uses: docker/login-action@v1

      # - name: run docker compose
      #   run: docker-compose -f /search-microservice

      - name: Build Docker Image - API
        uses: docker/build-push-action@v2
        with:
          push: true
          file: search-microservice/Dockerfile
          context: ./search-microservice
          tags: search-searvice-test:latest



# name: ep-mern-ms-search-ci-cd

# on:
#   push:
#     branches:
#       - main
#     tags: ['v*.*.*']
#   pull_request:
#     branches:
#       - main
#     tags: ['v*.*.*']
# env:
#   IMAGE_NAME: ep-mern-searchservice-testing
#   BRANCH_NAME: ${{ github.ref}}

# defaults:
#   run:
#     working-directory: ./api

# jobs:
#   build:
#     name: build container image
#     runs-on: ubuntu-latest
#     steps:
#       - name: Checkout code
#         uses: actions/checkout@v2

#       - run: echo $BRANCH_NAME

#       - name: get version
#         id: tag
#         uses: AndreasP-92/ep-mern-ms-search@main

#       - name: Log into registry
#         uses: docker/login-action@v1
#         with:
#           registry: ${{ secrets.ACR_ENDPOINT }}
#           username: ${{ secrets.ACR_USERNAME }}
#           password: ${{ secrets.ACR_PASSWORD }}

#       - name: Build Docker Image - API
#         uses: docker/build-push-action@v2
#         with:
#           file: search-microservice/Dockerfile
#           context: ./search-microservice
#           push: false
#           tags: myimage:latest

      # - name: Build & Push
      #   uses: docker/build-push-action@v2
      #   with:
      #     push: true
      #     build-args: |
      #       version=${{ steps.tag.outputs.tag }}
      #     file: Dockerfile
      #     context: ./search-microservice
      #     dockerfile: ./search-microservice/Dockerfile
      #     tags: ${{ secrets.ACR_ENDPOINT }}/${{ env.IMAGE_NAME }}:${{ steps.tag.outputs.tag }}


# run-name: ${{ github.actor }} is testing out GitHub Actions üöÄ
# on: [push]
# jobs:
#   Explore-GitHub-Actions:
#     runs-on: ubuntu-latest
#     steps:
#       - run: echo "üéâ The job was automatically triggered by a ${{ github.event_name }} event."
#       - run: echo "üêß This job is now running on a ${{ runner.os }} server hosted by GitHub!"
#       - run: echo "üîé The name of your branch is ${{ github.ref }} and your repository is ${{ github.repository }}."
#       - name: Check out repository code
#         uses: actions/checkout@v3
#       - run: echo "üí° The ${{ github.repository }} repository has been cloned to the runner."
#       - run: echo "üñ•Ô∏è The workflow is now ready to test your code on the runner."
#       - name: List files in the repository
#         run: |
#           ls ${{ github.workspace }}
#       - run: echo "üçè This job's status is ${{ job.status }}."
